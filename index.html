<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Background Remover</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gray-100 flex items-center justify-center">
  <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full">
    <h1 class="text-2xl font-bold mb-4 text-center">Image Background Remover</h1>

    <!-- Drop Zone -->
    <div id="dropZone"
      class="w-full h-40 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-xl mb-4 cursor-pointer hover:bg-gray-50 transition">
      <span id="dropText" class="text-gray-500">Drag & Drop or Click to Upload</span>
      <input id="fileInput" type="file" class="hidden" accept="image/*" />
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="flex items-center justify-center mb-4 hidden">
      <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2"></div>
    </div>

    <!-- Preview area -->
    <div id="resultContainer" class="mb-4 hidden">
      <img id="resultImage" class="w-full rounded-xl" />
      <a id="downloadBtn" class="mt-3 block text-center bg-gray-800 text-white py-2 rounded-xl hover:bg-gray-700" download>
        Download Result
      </a>
    </div>

    <!-- Error message -->
    <div id="errorMessage" class="text-red-600 text-center hidden"></div>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const loading = document.getElementById('loading');
    const resultImage = document.getElementById('resultImage');
    const resultContainer = document.getElementById('resultContainer');
    const downloadBtn    = document.getElementById('downloadBtn');
    const errorMessage   = document.getElementById('errorMessage');
    const dropText       = document.getElementById('dropText');

    // Open file dialog on click
    dropZone.addEventListener('click', () => fileInput.click());

    // Handle file selection
    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

    // Handle drag-and-drop
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('bg-gray-50');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('bg-gray-50');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('bg-gray-50');
      handleFile(e.dataTransfer.files[0]);
    });

    async function handleFile(file) {
      if (!file) return;

      // Reset UI
      dropText.textContent = file.name;
      resultContainer.classList.add('hidden');
      errorMessage.classList.add('hidden');

      // Show spinner
      loading.classList.remove('hidden');

      try {
        const formData = new FormData();
        formData.append('image_file', file);

        const response = await fetch("https://clipdrop-api.co/remove-background/v1",
        {
          method: "POST",
          headers: { "x-api-key": "48280b94b088e6b712a58ae6cdad55303b23b0317eae4574966e522821f137f9547b02735c40b4fad28908c71744656b" },
          body: formData
        });

        if (!response.ok) {
          throw new Error('API request failed');
        }

        const blob = await response.blob();
        const url  = URL.createObjectURL(blob);

        // Show result
        resultImage.src        = url;
        downloadBtn.href       = url;
        resultContainer.classList.remove('hidden');
      } catch (err) {
        errorMessage.textContent = "Something went wrong. Please try again.";
        errorMessage.classList.remove('hidden');
      } finally {
        loading.classList.add('hidden');
      }
    }
  </script>
</body>
</html>
